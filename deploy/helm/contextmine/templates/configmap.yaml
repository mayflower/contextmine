apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "contextmine.fullname" . }}-config
  labels:
    {{- include "contextmine.labels" . | nindent 4 }}
data:
  # API settings
  DEBUG: {{ .Values.config.debug | quote }}
  API_HOST: "0.0.0.0"
  API_PORT: "8000"

  # Public URLs
  PUBLIC_BASE_URL: {{ .Values.config.publicBaseUrl | quote }}
  MCP_OAUTH_BASE_URL: {{ .Values.config.mcpOauthBaseUrl | quote }}
  MCP_ALLOWED_ORIGINS: {{ .Values.config.mcpAllowedOrigins | quote }}

  # Prefect settings (for worker)
  PREFECT_API_URL: {{ include "contextmine.prefectApiUrl" . | quote }}

  # Default LLM settings
  {{- if .Values.config.llm.defaultEmbeddingModel }}
  DEFAULT_EMBEDDING_MODEL: {{ .Values.config.llm.defaultEmbeddingModel | quote }}
  {{- end }}
  {{- if .Values.config.llm.defaultProvider }}
  DEFAULT_LLM_PROVIDER: {{ .Values.config.llm.defaultProvider | quote }}
  {{- end }}
  {{- if .Values.config.llm.defaultModel }}
  DEFAULT_LLM_MODEL: {{ .Values.config.llm.defaultModel | quote }}
  {{- end }}

  # Research agent settings
  ARTIFACT_STORE: {{ .Values.config.research.artifactStore | quote }}
  ARTIFACT_DIR: {{ .Values.config.research.artifactDir | quote }}
  ARTIFACT_TTL_MINUTES: {{ .Values.config.research.artifactTtlMinutes | quote }}
  ARTIFACT_MAX_RUNS: {{ .Values.config.research.artifactMaxRuns | quote }}
  RESEARCH_MODEL: {{ .Values.config.research.model | quote }}
  RESEARCH_MAX_TOKENS: {{ .Values.config.research.maxTokens | quote }}
  RESEARCH_BUDGET_STEPS: {{ .Values.config.research.budgetSteps | quote }}

  # SCIP Polyglot Indexing settings
  SCIP_LANGUAGES: {{ .Values.config.scip.languages | quote }}
  SCIP_INSTALL_DEPS_MODE: {{ .Values.config.scip.installDepsMode | quote }}
  SCIP_TIMEOUT_PYTHON: {{ .Values.config.scip.timeoutPython | quote }}
  SCIP_TIMEOUT_TYPESCRIPT: {{ .Values.config.scip.timeoutTypescript | quote }}
  SCIP_TIMEOUT_JAVA: {{ .Values.config.scip.timeoutJava | quote }}
  SCIP_TIMEOUT_PHP: {{ .Values.config.scip.timeoutPhp | quote }}
  SCIP_NODE_MEMORY_MB: {{ .Values.config.scip.nodeMemoryMb | quote }}
  SCIP_BEST_EFFORT: {{ .Values.config.scip.bestEffort | quote }}

  # OpenTelemetry settings
  {{- if .Values.monitoring.otel.enabled }}
  OTEL_ENABLED: "true"
  OTEL_SERVICE_NAME: {{ .Values.monitoring.otel.serviceName | quote }}
  OTEL_EXPORTER_OTLP_ENDPOINT: {{ .Values.monitoring.otel.exporterEndpoint | quote }}
  OTEL_EXPORTER_OTLP_PROTOCOL: {{ .Values.monitoring.otel.exporterProtocol | quote }}
  OTEL_TRACES_SAMPLER: {{ .Values.monitoring.otel.tracesSampler | quote }}
  OTEL_TRACES_SAMPLER_ARG: {{ .Values.monitoring.otel.tracesSamplerArg | quote }}
  OTEL_LOG_LEVEL: {{ .Values.monitoring.otel.logLevel | quote }}
  {{- else }}
  OTEL_ENABLED: "false"
  {{- end }}

  # Grafana Faro (frontend observability) settings
  {{- if .Values.monitoring.faro.enabled }}
  FARO_COLLECTOR_URL: {{ .Values.monitoring.faro.collectorUrl | quote }}
  {{- end }}
