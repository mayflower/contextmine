{{- if not .Values.secrets.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "contextmine.fullname" . }}-secrets
  labels:
    {{- include "contextmine.labels" . | nindent 4 }}
type: Opaque
stringData:
  # Database URL
  DATABASE_URL: {{ include "contextmine.databaseUrl" . | quote }}

  # GitHub OAuth credentials
  {{- if .Values.secrets.github.clientId }}
  GITHUB_CLIENT_ID: {{ .Values.secrets.github.clientId | quote }}
  {{- end }}
  {{- if .Values.secrets.github.clientSecret }}
  GITHUB_CLIENT_SECRET: {{ .Values.secrets.github.clientSecret | quote }}
  {{- end }}

  # Security keys
  SESSION_SECRET: {{ .Values.secrets.sessionSecret | quote }}
  TOKEN_ENCRYPTION_KEY: {{ .Values.secrets.tokenEncryptionKey | quote }}

  # LLM provider API keys (optional)
  {{- if .Values.secrets.openaiApiKey }}
  OPENAI_API_KEY: {{ .Values.secrets.openaiApiKey | quote }}
  {{- end }}
  {{- if .Values.secrets.anthropicApiKey }}
  ANTHROPIC_API_KEY: {{ .Values.secrets.anthropicApiKey | quote }}
  {{- end }}
  {{- if .Values.secrets.geminiApiKey }}
  GEMINI_API_KEY: {{ .Values.secrets.geminiApiKey | quote }}
  {{- end }}
{{- end }}

---
# PostgreSQL credentials secret (for StatefulSet)
{{- if .Values.postgresql.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "contextmine.fullname" . }}-postgres-secrets
  labels:
    {{- include "contextmine.postgres.labels" . | nindent 4 }}
type: Opaque
stringData:
  POSTGRES_USER: {{ .Values.postgresql.auth.username | quote }}
  POSTGRES_PASSWORD: {{ .Values.postgresql.auth.password | quote }}
  POSTGRES_DB: {{ .Values.postgresql.auth.database | quote }}
{{- end }}
